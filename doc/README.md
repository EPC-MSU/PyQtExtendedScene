# PyQtExtendedScene

## Описание модуля

* **doc** - папка с описанием модуля.
* **examples** - папка с примерами.

* **PyQtExtendedScene** - папка с модулем.
    * **basecomponent.py** - файл с базовым классом **BaseComponent** для компонентов.
    * **componentgroup.py** - файл с классом **ComponentGroup** для составных компонентов.
    * **extendedscene.py** - файл с основным виджетом/сценой **ExtendedScene** для рисования компонентов.
    * **pointcomponent.py** - файл с классом **PointComponent** компонента, который представляет собой точку.
    * **rectcomponent.py** - файл с классом **RectComponent** компонента, который представляет собой прямоугольник.
    * **rubberband** - файл с классом **RubberBand** для отображения выделенного прямоугольника.
    * **scenemode.py** - файл с перечислением режимов **SceneMode**, в которых может находиться сцена.
    * **sender.py** - файл с вспомогательным классом для отправки Qt-сигналов. 
    * **utils.py** - файл с мелкими функциями.
* **scripts** - папка со скриптами для выпуска релиза.
* **tests** - тесты.

## Типы компонентов

В **PyQtExtendedScene** есть компоненты следующих типов:
* **PointComponent** - точка;
* **RectComponent** - прямоугольник;
* **ComponentGroup** - составной компонент.

Составной компонент может включать в себя прямоугольники и точки.

Компонентам можно задать следующие атрибуты, которые влияют на поведение компонентов в обычном режиме (о режимах работы написано ниже):

* **draggable** - компонент можно перемещать в обычном режиме;
* **selectable** - компонент можно выбирать в обычном режиме;
* **unique_selection** - компонент может быть выбран только единолично.

## Режимы

Виджет **ExtendedScene** может находиться в одном из режимов:
* **NORMAL** - обычный режим;
* **EDIT** - режим редактирования;
* **EDIT_GROUP** - режим редактирования составного компонента.

#### Общий функционал для всех режимов

Во всех режимах можно:

- Перетаскивать сцену зажатой **ЛЕВОЙ** кнопкой мышки.

  <img src="images/dragging_scene.gif" alt="Перетаскивание сцены" style="zoom:50%;" />

- Зумировать сцену колесиком мышки.

  <img src="images/zooming.gif" alt="Зумирование" style="zoom:50%;" />

- Выделять компонент кликом **ЛЕВОЙ** кнопки мышки.

- Выделять несколько компонентов кликом **ЛЕВОЙ** кнопки мышки с зажатой клавишей **Ctrl**.

  <img src="images/multiple_selection_ctrl.gif" alt="Множественное выделение с помощью Ctrl" style="zoom:50%;" />

- Копировать выделанные компоненты с помощью быстрых клавиш **Ctrl + C**.

- Вырезать выделенные компоненты с помощью быстрых клавиш **Ctrl + X**.

- Вставлять скопированные/вырезанные компоненты с помощью быстрых клавиш **Ctrl + V**.

  <img src="images/copy_cut_paste.gif" alt="Копирование, вырезание и вставление" style="zoom:50%;" />

- Удалять выделенные компоненты с помощью клавиши **Delete**.

  <img src="images/deleting.gif" alt="Удаление" style="zoom:50%;" />

#### Обычный режим

По умолчанию сцена находится в обычном режиме. Для перехода в обычный режим нужно вызвать метод:

```python
scene.set_scene_mode(SceneMode.NORMAL)
```

В обычном режиме можно:
* Выделять компоненты движением мышки с зажатой **ПРАВОЙ** кнопкой мышки.

  <img src="images/selecting.gif" alt="Множественное выделение" style="zoom:50%;" />
  
* Можно задать режим, при котором выделенный зажатой правой кнопкой мышки прямоугольник останется видимым после того, как правая кнопка мышки будет освобождена. Для этого нужно вызвать метод:

  ```python
  scene.show_rubber_band_after_mouse_release()
  ```

  <img src="images/show_unlimited_rubber_band.gif" alt="Множественное выделение и видимость выделенного прямоугольника" style="zoom:50%;" />

  Можно ограничить выделенный прямоугольник только областью фонового изображения. Для этого нужно вызвать метод:

  ```python
  scene.limit_rubber_band_size_to_background(True)
  ```

  <img src="images/show_limited_rubber_band.gif" alt="Множественное выделение и видимость выделенного прямоугольника только на фоне" style="zoom:50%;" />

  Чтобы вернуться к обычному режиму, при котором выделенный прямоугольник исчезает после освобождения правой кнопки мышки, нужно вызвать метод:

  ```python
  scene.hide_rubber_band_after_mouse_release()
  ```

По умолчанию все компоненты можно выделять и перетаскивать. Чтобы запретить выделение компонента в обычном режиме, при создании компонента нужно передать аргумент:

```python
component = Component(selectable=False)
```

Чтобы запретить перетаскивание компонента в обычном режиме, при создании компонента нужно передать аргумент:

```python
component = Component(draggable=False)
```

#### Режим редактирования

Для перехода в режим редактирования нужно вызвать метод:

```python
scene.set_scene_mode(SceneMode.EDIT)
```

В режиме редактирования можно:
* Рисовать точку кликом **ПРАВОЙ** кнопки мышки с нажатой клавишей **Shift**.

  <img src="images/point_creation.gif" alt="Создание точек" style="zoom:50%;" />

* Рисовать прямоугольник зажатой **ПРАВОЙ** кнопкой мышки.

  <img src="images/rect_creation.gif" alt="Создание прямоугольников" style="zoom:50%;" />

* Перетаскивать точку, прямоугольник, составной компонент зажатой **ЛЕВОЙ** кнопкой мышки при наведении мышки внутрь соответствующего компонента. Если перетаскиваемые точка или прямоугольник находятся в составном компоненте, то составной компонент перетаскивается целиком.

  <img src="images/dragging.gif" alt="Перетаскивание" style="zoom:50%;" />

* Изменять размеры прямоугольника, который не находится в составном компоненте. Для этого нужно навести мышку на границу прямоугольника и зажать **ЛЕВУЮ** кнопку мышки.

  <img src="images/resizing.gif" alt="Изменение размеров прямоугольника" style="zoom:50%;" />

В режиме редактирования все компоненты, которые не являются частью составного компонента, могут выделяться и перетаскиваться.

#### Режим редактирования составного компонента

Для перехода в режим редактирования составного компонента нужно выделить составной компонент и вызвать метод:

```python
scene.set_scene_mode(SceneMode.EDIT_GROUP)
```

Если при переходе в этот режим не был выделен составной компонент либо были выделены несколько составных компонентов, то будет создан новый (пустой) составной компонент.

В режиме редактирования составного компонента можно:

* Рисовать точку кликом **ПРАВОЙ** кнопки с нажатой клавишей **Shift**.
* Рисовать прямоугольник зажатой **ПРАВОЙ** кнопкой мышки.
* Перетаскивать точку, прямоугольник, находящиеся внутри составного компонента. Для этого нужно навести мышку внутрь точки/прямоугольника и зажать **ЛЕВУЮ** кнопку мышки.
* Изменять размеры прямоугольника, который находится внутри составного компонента. Для этого нужно навести мышку на границу прямоугольника и зажать **ЛЕВУЮ** кнопку мышки.

Все созданные точки/прямоугольники будут включены в состав нового составного компонента. Например, если скопировать составной компонент, а потом в режиме **EDIT_GROUP** произвести вставку, то все части скопированного составного компонента окажутся в составе редактируемого составного компонента.

<img src="images/copy_group_component_and_paste_in_edit_group.gif" alt="Вставка скопированных компонентов в режиме редактирования составного компонента" style="zoom:50%;" />

